<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>カタログ</title>
	<link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
	<link th:href="@{/css/style.css}" rel="stylesheet">
</head>

<body>
	<div class="container">
		<h1>カタログ</h1>

		<form th:action="@{/catalog/search}">
			<p>
				<input type="text" name="title" placeholder="タイトル">
				<input type="submit" name="titleButton" value="タイトルで絞り込み">
			</p>
		</form>

		<h3 th:if="${searchedBy}">「[[${searchedBy}]]」で絞り込み中</h3>

		<div class="tile-container">
			<div class="tile" th:each="video : ${videos}">
				<a th:href="@{catalog/details/{id}(id=${video.id})}" class="tile-link">
					<div class="tile-background" th:style="'background-image: url(' + ${video.thumbnailUrl} + ')'">
						<div class="tile-content">
							<div>[[${video.title}]]</div>
							<div>[[${video.rating}]]</div>
							<div th:if="${session.user != null and session.user.role.name() == 'Admin'}">
								<a th:href="@{/catalog/remove/{id}(id=${video.id})}" th:data-title="${video.title}"
									class="btn btn-danger delete">削除</a>
							</div>
						</div>
					</div>
				</a>
			</div>
		</div>
		<div class="back-link">
				<a th:href="@{/dashboard}">← ダッシュボードに戻る</a>
		</div>
	</div>
	<!--ページネーションスタート-->
	<div class="pagination-container">
		<div th:if="${totalPages >= 2}" class="container2">
			<ul class="pagination">
				<!--前のページへ-->
				<th:block th:switch="${page}">
					<li th:case="1" class="page-item disabled">
						<a class="page-link" href="">&laquo;</a>
					</li>
					<li th:case="*" class="page-item">
						<a class="page-link" th:href="@{/catalog(page=${page - 1})}">&laquo;</a>
					</li>
				</th:block>

				<!--ページ番号-->
				<th:block th:each="index : ${#numbers.sequence(1, totalPages)}">
					<th:block th:switch="${index}">
						<li th:case="${page}" class="page-item active">
							<a class="page-link" href="">[[${index}]]</a>
						</li>
						<li th:case="*" class="page-item">
							<a class="page-link" th:href="@{/catalog(page=${index})}">[[${index}]]</a>
						</li>
					</th:block>
				</th:block>

				<!--次のページへ-->
				<th:block th:switch="${page}">
					<li th:case="${totalPages}" class="page-item disabled">
						<a class="page-link" th:href="@{/catalog(page=${page + 1})}">&raquo;</a>
					</li>
				</th:block>
		</div>
	</div>
	<!-- ページネーションを表示:end -->
</div>
	<footer>
		<p>&copy; 2025 nEdFLiGz. All rights reserved.</p>
	</footer>
</body>
<script>
	document.addEventListener("DOMContentLoaded", function () {
		document.querySelectorAll(".delete").forEach(btn => {
			btn.addEventListener("click", function (e) {
				const title = this.dataset.title;
				if (!confirm(`「${title}」を削除します。よろしいですか？`)) {
					e.preventDefault();
				}
			});
		});
	});
</script>

</html>